<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add New Item</title>
    <!-- Bootstrap 5.3 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
      }

      .main-content {
        padding: 20px;
      }
      #drop-area {
        border: 2px dashed #ccc;
        border-radius: 20px;
        width: 100%;
        padding: 20px;
        text-align: center;
        background-color: #f8f9fa;
        transition: background-color 0.3s;
      }
      #drop-area.highlight {
        background-color: #e3f2fd;
      }
      #preview {
        max-width: 100%;
        max-height: 200px;
        margin-top: 10px;
      }

      /* Hide the donor name input by default */
      #donorNameWrapper {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        {% include 'auth/components/sidebar.html' %}

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
          <div
            class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
          >
            <h1 class="h2">Add New Item</h1>
          </div>

          <form
            id="addItemForm"
            class="needs-validation"
            method="POST"
            action="{{ url_for('auth.add_item') }}"
            enctype="multipart/form-data"
            novalidate
          >
            <div class="mb-3">
              <label for="name" class="form-label">Name</label>
              <input
                type="text"
                class="form-control"
                id="name"
                name="name"
                required
              />
              <div class="invalid-feedback">
                Please provide a name for the item.
              </div>
            </div>
            <div class="mb-3">
              <label for="fee" class="form-label">Fee</label>
              <input
                type="number"
                class="form-control"
                id="fee"
                name="fee"
                required
              />
              <div class="invalid-feedback">Please provide a valid fee.</div>
            </div>
            <div class="mb-3">
              <label for="description" class="form-label">Description</label>
              <textarea
                class="form-control"
                id="description"
                name="description"
                rows="3"
                required
              ></textarea>
              <div class="invalid-feedback">Please provide a description.</div>
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="adopted"
                  name="adopted"
                  onchange="toggleDonorNameInput()"
                />
                <label class="form-check-label" for="adopted"> Adopted </label>
              </div>
            </div>

            <!-- Dynamic input for donor name -->
            <div class="mb-3" id="donorNameWrapper">
              <label for="donorName" class="form-label">Donor Name</label>
              <input
                type="text"
                class="form-control"
                id="donorName"
                name="donorName"
                placeholder="Enter the donor's name"
              />
            </div>

            <div class="mb-3">
              <label for="drop-area" class="form-label">Image</label>
              <div id="drop-area">
                <p>Drag and drop an image here, or click to select a file</p>
                <input
                  type="file"
                  id="fileElem"
                  name="fileElem"
                  accept="image/*"
                  onchange="handleFiles(this.files)"
                />
                <img
                  id="preview"
                  src="#"
                  alt="Image preview"
                  style="display: none"
                />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Add Item</button>
          </form>
        </main>
      </div>
    </div>

    <!-- Bootstrap 5.3 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Drag and drop functionality
      let dropArea = document.getElementById("drop-area");
      let fileElem = document.getElementById("fileElem");
      let preview = document.getElementById("preview");

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropArea.addEventListener(eventName, preventDefaults, false);
      });

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover"].forEach((eventName) => {
        dropArea.addEventListener(eventName, highlight, false);
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropArea.addEventListener(eventName, unhighlight, false);
      });

      function highlight(e) {
        dropArea.classList.add("highlight");
      }

      function unhighlight(e) {
        dropArea.classList.remove("highlight");
      }

      dropArea.addEventListener("drop", handleDrop, false);

      function handleDrop(e) {
        let dt = e.dataTransfer;
        let files = dt.files;
        handleFiles(files);
      }

      function handleFiles(files) {
        if (files.length > 0) {
          let file = files[0];
          if (file.type.startsWith("image/")) {
            let reader = new FileReader();
            reader.onload = function (e) {
              preview.src = e.target.result;
              preview.style.display = "block";
            };
            reader.readAsDataURL(file);
          } else {
            alert("Please upload an image file.");
          }
        }
      }

      dropArea.addEventListener("click", () => fileElem.click());

      // Function to toggle donor name input visibility
      function toggleDonorNameInput() {
        const adoptedCheckbox = document.getElementById("adopted");
        const donorNameWrapper = document.getElementById("donorNameWrapper");

        if (adoptedCheckbox.checked) {
          donorNameWrapper.style.display = "block"; // Show the donor name input
        } else {
          donorNameWrapper.style.display = "none"; // Hide the donor name input
        }
      }

      // Form validation
      (function () {
        "use strict";
        var forms = document.querySelectorAll(".needs-validation");
        Array.prototype.slice.call(forms).forEach(function (form) {
          form.addEventListener(
            "submit",
            function (event) {
              if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
                form.classList.add("was-validated");
              }
            },
            false
          );
        });
      })();
    </script>
  </body>
</html>
